From d771f54bae2a6c597117de031c5da7ed33fa74d1 Mon Sep 17 00:00:00 2001
From: Seimizu Joukan <joukan.seimizu@gmail.com>
Date: Sat, 3 Jun 2017 15:10:53 +0900
Subject: [PATCH] Linux kenrel built-in ipcon module.

---
 net/netlink/Makefile   |  2 +-
 net/netlink/ipcon_in.c | 17 +++++++++++++++++
 net/netlink/ipcon_in.h |  6 ++++++
 3 files changed, 24 insertions(+), 1 deletion(-)
 create mode 100644 net/netlink/ipcon_in.c
 create mode 100644 net/netlink/ipcon_in.h

diff --git a/net/netlink/Makefile b/net/netlink/Makefile
index e837917..d2b74e9 100644
--- a/net/netlink/Makefile
+++ b/net/netlink/Makefile
@@ -2,7 +2,7 @@
 # Makefile for the netlink driver.
 #
 
-obj-y  				:= af_netlink.o genetlink.o
+obj-y  				:= af_netlink.o genetlink.o ipcon_in.o
 
 obj-$(CONFIG_NETLINK_DIAG)	+= netlink_diag.o
 netlink_diag-y			:= diag.o
diff --git a/net/netlink/ipcon_in.c b/net/netlink/ipcon_in.c
new file mode 100644
index 0000000..f0832dc
--- /dev/null
+++ b/net/netlink/ipcon_in.c
@@ -0,0 +1,17 @@
+#include <net/genetlink.h>
+#include "af_netlink.h"
+
+void ipcon_clear_multicast_user(struct genl_family *family, unsigned int group)
+{
+	struct net *net;
+
+	netlink_table_grab();
+	rcu_read_lock();
+	for_each_net_rcu(net) {
+		__netlink_clear_multicast_users(net->genl_sock,
+						family->mcgrp_offset + group);
+	}
+	rcu_read_unlock();
+	netlink_table_ungrab();
+}
+EXPORT_SYMBOL(ipcon_clear_multicast_user);
diff --git a/net/netlink/ipcon_in.h b/net/netlink/ipcon_in.h
new file mode 100644
index 0000000..bd2bbcb
--- /dev/null
+++ b/net/netlink/ipcon_in.h
@@ -0,0 +1,6 @@
+#ifndef __IPCON_IN_H__
+#define __IPCON_IN_H__
+
+void ipcon_clear_multicast_user(struct genl_family *family, unsigned int group);
+
+#endif
-- 
2.7.4

